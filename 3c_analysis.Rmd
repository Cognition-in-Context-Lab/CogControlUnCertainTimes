---
title: "3C Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Packages
library(psych)
library(tidyverse)
#library(dplyr)
#library(plyr)
```


## Load and Cleanup Data
```{r}
#df <- read.csv("C:/Users/14083/Desktop/3C_Live_Study_NA_Data.csv")
df <- read.csv("C:/Users/14083/Desktop/3C_Live_Study_Data.csv", header=T, na.strings="")
#df <- read.csv("3C_Live_Study_NA_Data.csv")

# Drop unneeded rows (pilot data, incomplete trials,remove entries that are shorter than 6 mins longer than 60 minutes) & cols
unneeded_cols <- c("StartDate", "EndDate", "Status", "IPAddress", "Progress", "Finished", "RecordedDate", "ResponseId", "RecipientLastName", "RecipientFirstName", "RecipientEmail", "ExternalReference", "LocationLatitude", "LocationLongitude", "DistributionChannel", "UserLanguage", "Gender_4_TEXT...Parent.Topics", "Gender_4_TEXT...Sentiment.Polarity", "Gender_4_TEXT...Sentiment.Score", "Gender_4_TEXT...Sentiment", "Gender_4_TEXT...Topics", "Gender_4_TEXT...Topic.Sentiment.Label", "Gender_4_TEXT...Topic.Sentiment.Score")

# Return entries where duration was longer than 45 min.
df$'Duration..in.seconds.' = as.numeric(as.character(df$'Duration..in.seconds.'))
df[which(df$'Duration..in.seconds.' >= 45*60), ]

# return entries where duration was shorter than 6 mins.
df$'Duration..in.seconds.' = as.numeric(as.character(df$'Duration..in.seconds.'))
df[which(df$'Duration..in.seconds.' <= 360), ]

# remove Gender and Race open response columns to be able to remove rows with missing values
NAcols <- c("Gender_4_TEXT", "Race_6_TEXT")

df <- df[-c(1:7,8:12,22,205,222,255,324,415:444), ]
df <- df[ , !names(df) %in% unneeded_cols]
df <- df[ , !names(df) %in% NAcols]
```

## Creating COVID19 DoG Index 

#Add columns with time frames in days

```{r}
dog1 <- list("COVID_DoG_Questions.1", df$COVID_DoG_Questions.2_1, df$COVID_DoG_Questions.1_1)
dog2 <- list("COVID_DoG_Questions.2", df$COVID_DoG_Questions.2_2, df$COVID_DoG_Questions.1_2)
dog3 <- list("COVID_DoG_Questions.3", df$COVID_DoG_Questions.2_3, df$COVID_DoG_Questions.1_3)
dog4 <- list("COVID_DoG_Questions.4", df$COVID_DoG_Questions.2_4, df$COVID_DoG_Questions.1_4)
dog5 <- list("COVID_DoG_Questions.5", df$COVID_DoG_Questions.2_5, df$COVID_DoG_Questions.1_5)
dog6 <- list("COVID_DoG_Questions.6", df$COVID_DoG_Questions.2_6, df$COVID_DoG_Questions.1_6)
pandemic_len <- list("PandemicLengthExpect.1", df$PandemicLengthExpect.1_1, df$PandemicLengthExpect.2_1)

create_columns <- function(units_col, len_col) {
  case_when(as.numeric(substring(units_col, 1, 1)) == 1 ~ as.numeric(substring(len_col, 1, 1)) * 1,
            as.numeric(substring(units_col, 1, 1)) == 2 ~ as.numeric(substring(len_col, 1, 1)) * 7,
            as.numeric(substring(units_col, 1, 1)) == 3 ~ as.numeric(substring(len_col, 1, 1)) * 30,
            as.numeric(substring(units_col, 1, 1)) == 4 ~ as.numeric(substring(len_col, 1, 1)) * 365)
}

df <- df %>% mutate(!!dog1[[1]] := create_columns(dog1[[2]], dog1[[3]]),
              !!dog2[[1]] := create_columns(dog2[[2]], dog2[[3]]),
              !!dog3[[1]] := create_columns(dog3[[2]], dog3[[3]]),
              !!dog4[[1]] := create_columns(dog4[[2]], dog4[[3]]),
              !!dog5[[1]] := create_columns(dog5[[2]], dog5[[3]]),
              !!dog6[[1]] := create_columns(dog6[[2]], dog6[[3]]),
              !!pandemic_len[[1]] := create_columns(pandemic_len[[2]], pandemic_len[[3]]),
              .before = SocialNorms_Family_1
              )

#view(df)
```

## Remove missing values and convert classes
```{r}
#check where the missing values are
rowSums(is.na(df))

#remove missing values
##show where missing values are
df[!complete.cases(df), ]
##create new dataset with no missing values
omit_df <- na.omit(df)
#view(omit_df)
sum(is.na(omit_df))

#convert character values (except Nationality and Occupation) to numeric to be able to calculate stats
numeric_cols1 <- names(omit_df)[3:206] #ends on Race 
numeric_cols2 <- names(omit_df)[208] #education
numeric_cols3 <- names(omit_df)[210:224] #begins on Measure2_2 to end of columns

#view(omit_df)

omit_df[numeric_cols1] <- lapply(omit_df[numeric_cols1], as.numeric)
omit_df[numeric_cols2] <- lapply(omit_df[numeric_cols2], as.numeric)
omit_df[numeric_cols3] <- lapply(omit_df[numeric_cols3], as.numeric)

sapply(omit_df, class) # all numeric!

#view(omit_df)

#check that everyone included in omit_df passed both attention checks
omit_df$attentioncheck_1 #all 4s
omit_df$attentioncheck_2 #all 3s
```

## Demographics Analyses
```{r}
#duration, demographics
mean(df$Duration..in.seconds., na.rm = TRUE)
mean(omit_df$Duration..in.seconds.)
sd(omit_df$Duration..in.seconds.)

summary(omit_df$Age)
table(omit_df$Gender)
table(omit_df$Race)
table(omit_df$Education)
```


# Summary statistics
```{r}
summary(omit_df$PandemicLengthExpect.1)
describe(omit_df$COVID_DoG_Sum)
describe(omit_df$MCQ_Sum)
describe(omit_df$Norms_Sum)
describe(omit_df$GCS_Sum)
describe(omit_df$IUS_Sum)
describe(omit_df$MFQ_sum_part1)
describe(omit_df$MFQ_sum_part2)
describe(omit_df$MFQ_total_sum)
describe(omit_df$Disgust_Sum)
describe(omit_df$Perceived_Value_Sum)
describe(omit_df$SDRS_Sum)
describe(omit_df$Impacts_sum)
describe(omit_df$Experiences_sum)
describe(omit_df$Stress_Sum)
describe(omit_df$MFQ_total_sum)
describe(omit_df$Measure2_PO_Sum)
describe(omit_df$Measure5_PO_Sum)
describe(omit_df$PO_Total_Sum)
describe(omit_df$Perceived_Risk_Sum)
```


## Task Analyses
# Perceived Risk and Value
```{r}
mini_df <- omit_df %>% select(PerceivedRisk_1:PerceivedRisk_6)
#mini_df
omit_df <- omit_df %>% mutate(Perceived_Risk_Sum = rowSums(mini_df), .before = PerceivedValue_1)
omit_df$Perceived_Risk_Sum
mini_df <- omit_df %>% select(PerceivedValue_1:PerceivedValue_6)
omit_df <- omit_df %>% mutate(Perceived_Value_Sum = rowSums(mini_df), .before = GCS_1)
view(omit_df)
```

# COVID DoG
```{r}
mini_df <- omit_df %>% select(COVID_DoG_Questions.1:COVID_DoG_Questions.6)
omit_df <- omit_df %>% mutate(COVID_DoG_Sum = rowSums(mini_df), .before = PandemicLengthExpect.1)
```

# MCQ
```{r}
mini_df <- omit_df %>% select(MCQ_1:MCQ_27)
omit_df <- omit_df %>% mutate(MCQ_Sum = rowSums(mini_df), .before = COVID_DoG_Questions.1_1)
```

# Social Norms
```{r}
mini_df <- omit_df %>% select(SocialNorms_Family_1:SocialNorms_Stranger_3)
omit_df <- omit_df %>% mutate(Norms_Sum = rowSums(mini_df), .before = PerceivedRisk_1)
```

# General Confidence
```{r}
mini_df <- omit_df %>% select(contains("GCS"))
#mini_df
omit_df <- omit_df %>% mutate(GCS_Sum = rowSums(mini_df), .before = IUS_1)
omit_df$GCS_Sum
#view(omit_df)
```

# Intolerance of Uncertainty
```{r}
mini_df <- omit_df %>% select(IUS_1:IUS_12)
omit_df <- omit_df %>% mutate(IUS_Sum = rowSums(mini_df), .before = MFQpart1_1)
```

# Political Orientation
```{r}
# measure 2
mini_df <- omit_df %>% select(Measure2_2:Measure2_4)
omit_df <- omit_df %>% mutate(Measure2_PO_Sum = rowSums(mini_df), .before = Measure5_1)
# measure 5
mini_df <- omit_df %>% select(Measure5_1:Measure5_14)
omit_df <- omit_df %>% mutate(Measure5_PO_Sum = rowSums(mini_df))
#combining both measures
mini_df <- omit_df %>% select(contains("PO_Sum"))
#mini_df
omit_df <- omit_df %>% mutate(PO_Total_Sum = rowSums(mini_df))
```

# MFQ
```{r}
MFQ_part1 <- omit_df %>% select(MFQpart1_1:MFQpart1_16)
MFQ_part2 <- omit_df %>% select(MFQ_part2_1:MFQ_part2_16)
omit_df <- omit_df %>% mutate(MFQ_sum_part1 = rowSums(MFQ_part1), .before = MFQ_part2_1)
omit_df <- omit_df %>% mutate(MFQ_sum_part2 = rowSums(MFQ_part2), .before = Disgust_1)
view(omit_df)
MFQ_total <- omit_df %>% select(contains("MFQ_sum"))
#MFQ_total
omit_df <- omit_df %>% mutate(MFQ_total_sum = rowSums(MFQ_total), .before = Disgust_1)
```

# COVID Stress
```{r}
mini_df <- omit_df %>% select(contains("Worries") | contains("Problems") | contains("Checking"))
#mini_df
omit_df <- omit_df %>% mutate(Stress_Sum = rowSums(mini_df), .before = Impacts_financial1)
```

# COVID Impacts and Experiences
```{r}
Impacts <- omit_df %>% select(Impacts_financial1:Impacts_psychology3)
Experiences <- omit_df %>% select(contains("PersonalDiagnoses") | contains("Proximity") | contains("News"))
#Experiences
omit_df <- omit_df %>% mutate(Impacts_sum = rowSums(Impacts), .before = PersonalDiagnoses_1)
omit_df <- omit_df %>% mutate(Experiences_sum = rowSums(Experiences), .before = Age)
```

# Disgust
```{r}
mini_df <- omit_df %>% select(Disgust_1:Disgust_21)
omit_df <- omit_df %>% mutate(Disgust_Sum = rowSums(mini_df), .before = SDRS.5_Q1)
```

# Social Desirability
```{r}
mini_df <- omit_df %>% select(SDRS.5_Q1:SDRS.5_Q5)
omit_df <- omit_df %>% mutate(SDRS_Sum = rowSums(mini_df), .before = Worries_1)
#view(omit_df)
```
